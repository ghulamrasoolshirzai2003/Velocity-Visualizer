// Sentinel 40 - Cloud Architecture Icon System
// 40 icons across 5 categories with connection validation rules

import { iconEnhancements } from './iconEnhancements';

export const iconCategories = {
    SECURITY: 'Security',
    NETWORKING: 'Networking',
    COMPUTE: 'Compute',
    STORAGE: 'Storage',
    DEVOPS: 'DevOps'
};

export const connectionRules = {
    // Public-facing nodes that should not connect directly to sensitive resources
    PUBLIC: ['public-user', 'internet', 'cdn'],
    // Sensitive resources that need protection
    SENSITIVE: ['sql-database', 'nosql-database', 'vault', 'admin-service'],
    // Security layers that can mediate connections
    SECURITY_LAYER: ['waf', 'firewall', 'api-gateway', 'load-balancer', 'auth-service']
};

export const icons = [
    // SECURITY (8 icons)
    {
        id: 'waf',
        name: 'WAF',
        category: iconCategories.SECURITY,
        svg: 'M12 2L2 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-4 0-7-3-7-7V8l7-3.5L19 8v5c0 4-3 7-7 7z',
        color: '#ec4899'
    },
    {
        id: 'iam',
        name: 'IAM',
        category: iconCategories.SECURITY,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z',
        color: '#ec4899'
    },
    {
        id: 'firewall',
        name: 'Firewall',
        category: iconCategories.SECURITY,
        svg: 'M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z',
        color: '#ec4899'
    },
    {
        id: 'auth-service',
        name: 'Auth Service',
        category: iconCategories.SECURITY,
        svg: 'M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z',
        color: '#ec4899'
    },
    {
        id: 'vault',
        name: 'Vault',
        category: iconCategories.SECURITY,
        svg: 'M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z',
        color: '#ec4899'
    },
    {
        id: 'ssl-cert',
        name: 'SSL Certificate',
        category: iconCategories.SECURITY,
        svg: 'M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z',
        color: '#ec4899'
    },
    {
        id: 'encryption',
        name: 'Encryption',
        category: iconCategories.SECURITY,
        svg: 'M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z',
        color: '#ec4899'
    },
    {
        id: 'ddos-protection',
        name: 'DDoS Protection',
        category: iconCategories.SECURITY,
        svg: 'M12 2L2 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z',
        color: '#ec4899'
    },

    // NETWORKING (8 icons)
    {
        id: 'vpc',
        name: 'VPC',
        category: iconCategories.NETWORKING,
        svg: 'M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z',
        color: '#00f0ff'
    },
    {
        id: 'api-gateway',
        name: 'API Gateway',
        category: iconCategories.NETWORKING,
        svg: 'M12 2L2 7v10l10 5 10-5V7L12 2zm0 18.5l-8-4V8.3l8 4v8.2zm8-4l-8 4v-8.2l8-4v8.2z',
        color: '#00f0ff'
    },
    {
        id: 'load-balancer',
        name: 'Load Balancer',
        category: iconCategories.NETWORKING,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z',
        color: '#00f0ff'
    },
    {
        id: 'dns',
        name: 'DNS',
        category: iconCategories.NETWORKING,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z',
        color: '#00f0ff'
    },
    {
        id: 'cdn',
        name: 'CDN',
        category: iconCategories.NETWORKING,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z',
        color: '#00f0ff'
    },
    {
        id: 'vpn',
        name: 'VPN',
        category: iconCategories.NETWORKING,
        svg: 'M12.65 10C11.7 7.31 8.9 5.5 5.77 6.12c-2.29.46-4.15 2.29-4.63 4.58C.32 14.57 3.26 18 7 18c2.61 0 4.83-1.67 5.65-4H17v2c0 1.1.9 2 2 2s2-.9 2-2v-2c1.1 0 2-.9 2-2s-.9-2-2-2h-8.35zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z',
        color: '#00f0ff'
    },
    {
        id: 'public-user',
        name: 'Public User',
        category: iconCategories.NETWORKING,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z',
        color: '#00f0ff'
    },
    {
        id: 'internet',
        name: 'Internet',
        category: iconCategories.NETWORKING,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z',
        color: '#00f0ff'
    },

    // COMPUTE (8 icons)
    {
        id: 'vm',
        name: 'Virtual Machine',
        category: iconCategories.COMPUTE,
        svg: 'M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z',
        color: '#a855f7'
    },
    {
        id: 'container',
        name: 'Container',
        category: iconCategories.COMPUTE,
        svg: 'M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z',
        color: '#a855f7'
    },
    {
        id: 'serverless',
        name: 'Serverless Function',
        category: iconCategories.COMPUTE,
        svg: 'M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z',
        color: '#a855f7'
    },
    {
        id: 'gpu-instance',
        name: 'GPU Instance',
        category: iconCategories.COMPUTE,
        svg: 'M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 12H3V7h18v10zm-9-1h8v-2h-8v2zm0-3h8v-2h-8v2zm-4 3h2v-2H8v2zm0-3h2v-2H8v2z',
        color: '#a855f7'
    },
    {
        id: 'autoscale',
        name: 'Auto Scaling',
        category: iconCategories.COMPUTE,
        svg: 'M19 12h-2v3h-3v2h5v-5zM7 9h3V7H5v5h2V9zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16.01H3V4.99h18v14.02z',
        color: '#a855f7'
    },
    {
        id: 'kubernetes',
        name: 'Kubernetes',
        category: iconCategories.COMPUTE,
        svg: 'M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.18l8 4v7.64l-8 4-8-4V8.18l8-4z',
        color: '#a855f7'
    },
    {
        id: 'batch-job',
        name: 'Batch Processing',
        category: iconCategories.COMPUTE,
        svg: 'M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z',
        color: '#a855f7'
    },
    {
        id: 'admin-service',
        name: 'Admin Service',
        category: iconCategories.COMPUTE,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z',
        color: '#a855f7'
    },

    // STORAGE (8 icons)
    {
        id: 'sql-database',
        name: 'SQL Database',
        category: iconCategories.STORAGE,
        svg: 'M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4zm8 6c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9zm0 5c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3z',
        color: '#10b981'
    },
    {
        id: 'nosql-database',
        name: 'NoSQL Database',
        category: iconCategories.STORAGE,
        svg: 'M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4zm8 6c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9zm0 5c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3z',
        color: '#10b981'
    },
    {
        id: 'object-storage',
        name: 'Object Storage',
        category: iconCategories.STORAGE,
        svg: 'M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z',
        color: '#10b981'
    },
    {
        id: 'cache',
        name: 'Cache',
        category: iconCategories.STORAGE,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z',
        color: '#10b981'
    },
    {
        id: 'file-storage',
        name: 'File Storage',
        category: iconCategories.STORAGE,
        svg: 'M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z',
        color: '#10b981'
    },
    {
        id: 'backup',
        name: 'Backup Storage',
        category: iconCategories.STORAGE,
        svg: 'M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z',
        color: '#10b981'
    },
    {
        id: 'data-warehouse',
        name: 'Data Warehouse',
        category: iconCategories.STORAGE,
        svg: 'M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4zm8 6c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9zm0 5c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3z',
        color: '#10b981'
    },
    {
        id: 'queue',
        name: 'Message Queue',
        category: iconCategories.STORAGE,
        svg: 'M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z',
        color: '#10b981'
    },

    // DEVOPS (8 icons)
    {
        id: 'cicd',
        name: 'CI/CD Pipeline',
        category: iconCategories.DEVOPS,
        svg: 'M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z',
        color: '#f59e0b'
    },
    {
        id: 'monitoring',
        name: 'Monitoring',
        category: iconCategories.DEVOPS,
        svg: 'M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z',
        color: '#f59e0b'
    },
    {
        id: 'logging',
        name: 'Logging',
        category: iconCategories.DEVOPS,
        svg: 'M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z',
        color: '#f59e0b'
    },
    {
        id: 'alerting',
        name: 'Alerting',
        category: iconCategories.DEVOPS,
        svg: 'M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z',
        color: '#f59e0b'
    },
    {
        id: 'git-repo',
        name: 'Git Repository',
        category: iconCategories.DEVOPS,
        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z',
        color: '#f59e0b'
    },
    {
        id: 'artifact-registry',
        name: 'Artifact Registry',
        category: iconCategories.DEVOPS,
        svg: 'M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z',
        color: '#f59e0b'
    },
    {
        id: 'secrets-manager',
        name: 'Secrets Manager',
        category: iconCategories.DEVOPS,
        svg: 'M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z',
        color: '#f59e0b'
    },
    {
        id: 'config-service',
        name: 'Config Service',
        category: iconCategories.DEVOPS,
        svg: 'M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z',
        color: '#f59e0b'
    }
];

// Validation function to check if a connection is allowed
export const isConnectionAllowed = (sourceNode, targetNode) => {
    const sourceIcon = icons.find(icon => icon.id === sourceNode.data.iconId);
    const targetIcon = icons.find(icon => icon.id === targetNode.data.iconId);

    if (!sourceIcon || !targetIcon) return { allowed: true };

    // Block direct connections from PUBLIC nodes to SENSITIVE resources
    if (connectionRules.PUBLIC.includes(sourceIcon.id) &&
        connectionRules.SENSITIVE.includes(targetIcon.id)) {
        return {
            allowed: false,
            reason: `Direct connection from ${sourceIcon.name} to ${targetIcon.name} is unsafe. Use a security layer (WAF, API Gateway, etc.) instead.`
        };
    }

    // Block reverse connections (SENSITIVE to PUBLIC)
    if (connectionRules.SENSITIVE.includes(sourceIcon.id) &&
        connectionRules.PUBLIC.includes(targetIcon.id)) {
        return {
    // COMPUTE (8 icons)
    {
            id: 'vm',
                name: 'Virtual Machine',
                    category: iconCategories.COMPUTE,
                        svg: 'M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z',
                            color: '#a855f7'
        },
        {
            id: 'container',
                name: 'Container',
                    category: iconCategories.COMPUTE,
                        svg: 'M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z',
                            color: '#a855f7'
        },
        {
            id: 'serverless',
                name: 'Serverless Function',
                    category: iconCategories.COMPUTE,
                        svg: 'M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z',
                            color: '#a855f7'
        },
        {
            id: 'gpu-instance',
                name: 'GPU Instance',
                    category: iconCategories.COMPUTE,
                        svg: 'M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 12H3V7h18v10zm-9-1h8v-2h-8v2zm0-3h8v-2h-8v2zm-4 3h2v-2H8v2zm0-3h2v-2H8v2z',
                            color: '#a855f7'
        },
        {
            id: 'autoscale',
                name: 'Auto Scaling',
                    category: iconCategories.COMPUTE,
                        svg: 'M19 12h-2v3h-3v2h5v-5zM7 9h3V7H5v5h2V9zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16.01H3V4.99h18v14.02z',
                            color: '#a855f7'
        },
        {
            id: 'kubernetes',
                name: 'Kubernetes',
                    category: iconCategories.COMPUTE,
                        svg: 'M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.18l8 4v7.64l-8 4-8-4V8.18l8-4z',
                            color: '#a855f7'
        },
        {
            id: 'batch-job',
                name: 'Batch Processing',
                    category: iconCategories.COMPUTE,
                        svg: 'M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z',
                            color: '#a855f7'
        },
        {
            id: 'admin-service',
                name: 'Admin Service',
                    category: iconCategories.COMPUTE,
                        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z',
                            color: '#a855f7'
        },

        // STORAGE (8 icons)
        {
            id: 'sql-database',
                name: 'SQL Database',
                    category: iconCategories.STORAGE,
                        svg: 'M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4zm8 6c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9zm0 5c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3z',
                            color: '#10b981'
        },
        {
            id: 'nosql-database',
                name: 'NoSQL Database',
                    category: iconCategories.STORAGE,
                        svg: 'M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4zm8 6c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9zm0 5c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3z',
                            color: '#10b981'
        },
        {
            id: 'object-storage',
                name: 'Object Storage',
                    category: iconCategories.STORAGE,
                        svg: 'M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z',
                            color: '#10b981'
        },
        {
            id: 'cache',
                name: 'Cache',
                    category: iconCategories.STORAGE,
                        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z',
                            color: '#10b981'
        },
        {
            id: 'file-storage',
                name: 'File Storage',
                    category: iconCategories.STORAGE,
                        svg: 'M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z',
                            color: '#10b981'
        },
        {
            id: 'backup',
                name: 'Backup Storage',
                    category: iconCategories.STORAGE,
                        svg: 'M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z',
                            color: '#10b981'
        },
        {
            id: 'data-warehouse',
                name: 'Data Warehouse',
                    category: iconCategories.STORAGE,
                        svg: 'M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4zm8 6c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9zm0 5c0 2.21-3.58 4-8 4s-8-1.79-8-4v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3z',
                            color: '#10b981'
        },
        {
            id: 'queue',
                name: 'Message Queue',
                    category: iconCategories.STORAGE,
                        svg: 'M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z',
                            color: '#10b981'
        },

        // DEVOPS (8 icons)
        {
            id: 'cicd',
                name: 'CI/CD Pipeline',
                    category: iconCategories.DEVOPS,
                        svg: 'M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z',
                            color: '#f59e0b'
        },
        {
            id: 'monitoring',
                name: 'Monitoring',
                    category: iconCategories.DEVOPS,
                        svg: 'M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z',
                            color: '#f59e0b'
        },
        {
            id: 'logging',
                name: 'Logging',
                    category: iconCategories.DEVOPS,
                        svg: 'M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z',
                            color: '#f59e0b'
        },
        {
            id: 'alerting',
                name: 'Alerting',
                    category: iconCategories.DEVOPS,
                        svg: 'M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z',
                            color: '#f59e0b'
        },
        {
            id: 'git-repo',
                name: 'Git Repository',
                    category: iconCategories.DEVOPS,
                        svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z',
                            color: '#f59e0b'
        },
        {
            id: 'artifact-registry',
                name: 'Artifact Registry',
                    category: iconCategories.DEVOPS,
                        svg: 'M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z',
                            color: '#f59e0b'
        },
        {
            id: 'secrets-manager',
                name: 'Secrets Manager',
                    category: iconCategories.DEVOPS,
                        svg: 'M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z',
                            color: '#f59e0b'
        },
        {
            id: 'config-service',
                name: 'Config Service',
                    category: iconCategories.DEVOPS,
                        svg: 'M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z',
                            color: '#f59e0b'
        }
];

// Validation function to check if a connection is allowed
export const isConnectionAllowed = (sourceNode, targetNode) => {
    const sourceIcon = icons.find(icon => icon.id === sourceNode.data.iconId);
    const targetIcon = icons.find(icon => icon.id === targetNode.data.iconId);

    if (!sourceIcon || !targetIcon) return { allowed: true };

    // Block direct connections from PUBLIC nodes to SENSITIVE resources
    if (connectionRules.PUBLIC.includes(sourceIcon.id) &&
        connectionRules.SENSITIVE.includes(targetIcon.id)) {
        return {
            allowed: false,
            reason: `Direct connection from ${sourceIcon.name} to ${targetIcon.name} is unsafe. Use a security layer (WAF, API Gateway, etc.) instead.`
        };
    }

    // Block reverse connections (SENSITIVE to PUBLIC)
    if (connectionRules.SENSITIVE.includes(sourceIcon.id) &&
        connectionRules.PUBLIC.includes(targetIcon.id)) {
        return {
            allowed: false,
            reason: `${sourceIcon.name} should not directly connect to ${targetIcon.name}.`
        };
    }

    return { allowed: true };
};